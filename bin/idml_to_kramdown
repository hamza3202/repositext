#!/usr/bin/env ruby
# -*- encoding: utf-8 -*-

require 'kramdown/document'
require 'kramdown/parser/idml'
require 'repositext/kramdown_adaptions'

idml_parser = Kramdown::Parser::IDML.new(ARGV.shift)
STDERR.puts "Found #{idml_parser.story_names.size} stories: #{idml_parser.story_names.join(", ")}"
doc = idml_parser.parse(ARGV.empty? ? idml_parser.story_names : ARGV)
STDOUT.puts doc.to_kramdown
